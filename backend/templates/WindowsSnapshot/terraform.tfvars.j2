# Derived VM name (Course + Lab formatted)
{% set course_fmt = tf_vars.course[0].upper() + tf_vars.course[1:].lower() %}
{% set lab_raw = (lab_name.split('/')[-1] | replace('.tfstate', '')) %}
{% set lab_fmt = lab_raw[0].upper() + lab_raw[1:] %}
vm_name = "Projects-{{ course_fmt }}-{{ lab_fmt }}-VM"

# lifecycle
lab_id     = "{{ (lab_name.split('/')[-1] | replace('.tfstate', '')) }}"
created_at = "{{ tf_vars.created_at }}"
expires_at = "{{ tf_vars.expires_at }}"
course     = "{{ course }}"

# module params
vm_count    = {{ tf_vars.vm_count }}
vm_size     = "{{ tf_vars.vm_size }}"
os_snapshot_id = "{{ tf_vars.snapshot_id }}"

data_disks = [
{% if tf_vars.data_disks and tf_vars.data_disks|length > 0 -%}
{%- for d in tf_vars.data_disks -%}
  {
    name         = "{{ d.name }}",
    lun          = {{ d.lun }},
    caching      = "{{ d.caching }}",
    disk_size_gb = {{ d.disk_size_gb }}
  }{{ "," if not loop.last }}
{%- endfor -%}
{%- endif -%}
]
