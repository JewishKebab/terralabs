# -------------------------
# Terraform variables file
# -------------------------

{# Course is passed at TOP LEVEL, not inside tf_vars #}
{% set course_fmt = course[:1].upper() + course[1:].lower() %}

{# Lab name without any folder prefix or .tfstate suffix #}
{% set lab_raw = (lab_name.split('/')[-1] | replace('.tfstate', '')) %}
{% set lab_fmt = lab_raw[:1].upper() + lab_raw[1:] %}

# Derived VM name (Projects-<Course>-<Lab>-VM)
vm_name = "Projects-{{ course_fmt }}-{{ lab_fmt }}-VM"

# Lifecycle tags / metadata
lab_id     = "{{ lab_raw }}"
created_at = "{{ tf_vars.created_at }}"
expires_at = "{{ tf_vars.expires_at }}"
course     = "{{ course }}"

# Module parameters
vm_count       = {{ tf_vars.vm_count }}
vm_size        = "{{ tf_vars.vm_size }}"
os_snapshot_id = "{{ tf_vars.snapshot_id }}"

# Optional data disks
data_disks = [
{% if tf_vars.data_disks and tf_vars.data_disks|length > 0 -%}
{%- for d in tf_vars.data_disks -%}
  {
    name         = "{{ d.name }}",
    lun          = {{ d.lun }},
    caching      = "{{ d.caching }}",
    disk_size_gb = {{ d.disk_size_gb }}
  }{{ "," if not loop.last }}
{%- endfor -%}
{%- endif -%}
]
